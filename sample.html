<!DOCTYPE html>
<html>

<head>
    <style>
        .modal-hidden {
            display: none !important;
        }

        .modal {
            align-items: center;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            left: 0;
            pointer-events: none;
            position: fixed;
            right: 0;
            top: 0;
        }

        .modal-overlay {
            background-color: rgba(0, 0, 0, .5);
            bottom: 0;
            display: none;
            left: 0;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 1000;
        }

        .modal-inner {
            background: #fff;
            max-height: 80%;
            overflow-y: auto;
            padding: 20px;
            pointer-events: all;
            width: 80%;
        }

        .modal-open.modal-overlay {
            display: block;
        }

        .has-modal {
            overflow: hidden;
        }
    </style>

    <script>
        var cg = window.cg || { data: [], push: function (t, yf, nf, d) { if (d == null) d = false; cg.data.push({ t: t, yf: yf, nf: nf, d: d }); } };

        cg.push('necessary', function () {
            console.log('necessary allowed header');
        }, function() {
            console.log('necessary denied header');
        }, true);

        cg.push('performance', function () {
            console.log('performance allowed header');
        }, function() {
            console.log('performance denied header');
        });

        cg.push('functionality', function () {
            console.log('functionality allowed header');
        }, function() {
            console.log('functionality denied header');
        });

        cg.push('targeting', function () {
            console.log('targeting allowed header');
        }, function() {
            console.log('targeting denied header');
        });
    </script>
</head>

<body>
    <!-- 'outerWrapper' is site's outermost DIV wrapper, so all focusable elements inside it are rendered "inert" to screen readers (via 'aria-hidden="true"') when modal is open. -->
    <div id="outerWrapper">
        <a href="#fallbackpage" class="cg-manage-opener">Manage Cookie Preferences</a>

        <h1>Example Website</h1>
        <a href="/index.html">Home</a> | <a href="/styled.html">Styled</a>

        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non
            nibh.
            Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis.
            Nullam
            at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in
            nunc
            erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.</p>
        <p>Pellentesque id eros diam. Nunc semper odio odio, et egestas arcu mattis nec. Sed et imperdiet arcu, vitae
            auctor
            nisl. Nunc nec libero odio. Donec a nisl mauris. Suspendisse et urna eu eros ultrices pellentesque vel nec
            elit.
            Praesent molestie suscipit orci et tristique. Praesent sed ipsum a justo luctus ornare.</p>
        <p>Vivamus ultrices nibh eu porttitor tincidunt. Sed non libero fermentum, dictum lectus a, semper ante. Aenean
            eget
            ipsum nulla. Maecenas accumsan tortor convallis felis vestibulum accumsan. Aenean tempus gravida enim et
            mattis.
            Ut ornare, nibh quis molestie vehicula, enim lacus condimentum nibh, id porttitor diam sem at quam. Fusce a
            eleifend erat. Vivamus vulputate risus condimentum augue suscipit, nec fringilla augue tincidunt.</p>
        <p>Maecenas pretium placerat purus, vel rhoncus neque varius ut. Aenean posuere placerat tempor. Integer
            lobortis
            libero vitae rutrum mollis. Fusce feugiat ligula nec velit rhoncus accumsan. Donec ut urna nunc. Donec
            laoreet
            ultricies enim suscipit luctus. Ut non lectus vitae sapien venenatis varius. Duis maximus dui at dolor
            pretium
            suscipit. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.
            Quisque
            odio nulla, dapibus et iaculis et, auctor ut leo. Nulla facilisi. In et elit gravida, aliquet ligula sit
            amet,
            lacinia arcu. Sed ultrices bibendum fermentum.</p>
        <p>Donec a elit sagittis, rhoncus lectus vel, semper nisi. Duis sagittis tempor purus blandit posuere.
            Vestibulum
            vitae volutpat elit. Donec porttitor, mi vel vulputate laoreet, tellus dolor suscipit leo, et pharetra massa
            dui
            ut urna. Pellentesque volutpat, libero sed dapibus aliquet, sapien orci consequat velit, nec ullamcorper
            elit
            libero id nisi. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris aliquet sed nulla nec
            dictum.
            Duis ut pellentesque tellus. Duis accumsan metus eu congue venenatis. Integer sodales, tellus in bibendum
            cursus, ante ex vestibulum dui, at pretium ipsum augue mollis est. Phasellus rutrum, libero laoreet iaculis
            accumsan, lorem metus efficitur purus, id vestibulum augue nunc non quam. Etiam vehicula dictum arcu. Sed
            posuere placerat nunc, sit amet iaculis ipsum lacinia sit amet. Aenean ultrices est odio, eu fermentum
            sapien
            rhoncus lacinia.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non
            nibh.
            Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis.
            Nullam
            at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in
            nunc
            erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.</p>
        <p>Pellentesque id eros diam. Nunc semper odio odio, et egestas arcu mattis nec. Sed et imperdiet arcu, vitae
            auctor
            nisl. Nunc nec libero odio. Donec a nisl mauris. Suspendisse et urna eu eros ultrices pellentesque vel nec
            elit.
            Praesent molestie suscipit orci et tristique. Praesent sed ipsum a justo luctus ornare.</p>
        <p>Vivamus ultrices nibh eu porttitor tincidunt. Sed non libero fermentum, dictum lectus a, semper ante. Aenean
            eget
            ipsum nulla. Maecenas accumsan tortor convallis felis vestibulum accumsan. Aenean tempus gravida enim et
            mattis.
            Ut ornare, nibh quis molestie vehicula, enim lacus condimentum nibh, id porttitor diam sem at quam. Fusce a
            eleifend erat. Vivamus vulputate risus condimentum augue suscipit, nec fringilla augue tincidunt.</p>
        <p>Maecenas pretium placerat purus, vel rhoncus neque varius ut. Aenean posuere placerat tempor. Integer
            lobortis
            libero vitae rutrum mollis. Fusce feugiat ligula nec velit rhoncus accumsan. Donec ut urna nunc. Donec
            laoreet
            ultricies enim suscipit luctus. Ut non lectus vitae sapien venenatis varius. Duis maximus dui at dolor
            pretium
            suscipit. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.
            Quisque
            odio nulla, dapibus et iaculis et, auctor ut leo. Nulla facilisi. In et elit gravida, aliquet ligula sit
            amet,
            lacinia arcu. Sed ultrices bibendum fermentum.</p>
        <p>Donec a elit sagittis, rhoncus lectus vel, semper nisi. Duis sagittis tempor purus blandit posuere.
            Vestibulum
            vitae volutpat elit. Donec porttitor, mi vel vulputate laoreet, tellus dolor suscipit leo, et pharetra massa
            dui
            ut urna. Pellentesque volutpat, libero sed dapibus aliquet, sapien orci consequat velit, nec ullamcorper
            elit
            libero id nisi. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris aliquet sed nulla nec
            dictum.
            Duis ut pellentesque tellus. Duis accumsan metus eu congue venenatis. Integer sodales, tellus in bibendum
            cursus, ante ex vestibulum dui, at pretium ipsum augue mollis est. Phasellus rutrum, libero laoreet iaculis
            accumsan, lorem metus efficitur purus, id vestibulum augue nunc non quam. Etiam vehicula dictum arcu. Sed
            posuere placerat nunc, sit amet iaculis ipsum lacinia sit amet. Aenean ultrices est odio, eu fermentum
            sapien
            rhoncus lacinia.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non
            nibh.
            Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis.
            Nullam
            at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in
            nunc
            erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.</p>
        <p>Pellentesque id eros diam. Nunc semper odio odio, et egestas arcu mattis nec. Sed et imperdiet arcu, vitae
            auctor
            nisl. Nunc nec libero odio. Donec a nisl mauris. Suspendisse et urna eu eros ultrices pellentesque vel nec
            elit.
            Praesent molestie suscipit orci et tristique. Praesent sed ipsum a justo luctus ornare.</p>
        <p>Vivamus ultrices nibh eu porttitor tincidunt. Sed non libero fermentum, dictum lectus a, semper ante. Aenean
            eget
            ipsum nulla. Maecenas accumsan tortor convallis felis vestibulum accumsan. Aenean tempus gravida enim et
            mattis.
            Ut ornare, nibh quis molestie vehicula, enim lacus condimentum nibh, id porttitor diam sem at quam. Fusce a
            eleifend erat. Vivamus vulputate risus condimentum augue suscipit, nec fringilla augue tincidunt.</p>
        <p>Maecenas pretium placerat purus, vel rhoncus neque varius ut. Aenean posuere placerat tempor. Integer
            lobortis
            libero vitae rutrum mollis. Fusce feugiat ligula nec velit rhoncus accumsan. Donec ut urna nunc. Donec
            laoreet
            ultricies enim suscipit luctus. Ut non lectus vitae sapien venenatis varius. Duis maximus dui at dolor
            pretium
            suscipit. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.
            Quisque
            odio nulla, dapibus et iaculis et, auctor ut leo. Nulla facilisi. In et elit gravida, aliquet ligula sit
            amet,
            lacinia arcu. Sed ultrices bibendum fermentum.</p>
        <p>Donec a elit sagittis, rhoncus lectus vel, semper nisi. Duis sagittis tempor purus blandit posuere.
            Vestibulum
            vitae volutpat elit. Donec porttitor, mi vel vulputate laoreet, tellus dolor suscipit leo, et pharetra massa
            dui
            ut urna. Pellentesque volutpat, libero sed dapibus aliquet, sapien orci consequat velit, nec ullamcorper
            elit
            libero id nisi. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris aliquet sed nulla nec
            dictum.
            Duis ut pellentesque tellus. Duis accumsan metus eu congue venenatis. Integer sodales, tellus in bibendum
            cursus, ante ex vestibulum dui, at pretium ipsum augue mollis est. Phasellus rutrum, libero laoreet iaculis
            accumsan, lorem metus efficitur purus, id vestibulum augue nunc non quam. Etiam vehicula dictum arcu. Sed
            posuere placerat nunc, sit amet iaculis ipsum lacinia sit amet. Aenean ultrices est odio, eu fermentum
            sapien
            rhoncus lacinia.</p>
    </div>

    <div class="modal-overlay" id="modal-for-notice">
        <div class="modal modal-hidden">
            <div class="modal-inner" role="dialog" aria-modal="true" aria-labelledby="modal-title">
                <h2 id="modal-for-notice-title">Cookie Notice</h2>
                <button id="modal-for-notice-close" onclick="closeModal(this)">Close</button>

                <article id="cg-notice" class="cookie-glue-container">
                    <p>This website uses cookies and similar technologies to improve your online experience and to show
                        tailored
                        advertising to you.</p>
                    <button class="cg-manage-opener">Manage</button> <button onclick="closeModal(this)">Accept</button>
                    <p>You can view our <a href="#">privacy policy</a> for more information.</p>
                </article>
            </div>
        </div>
    </div>
    <!-- Modal needs to be sibling of ALL other page content (i.e. direct child of <body>). -->
    <div class="modal-overlay" id="modal-for-manage">
        <div class="modal modal-hidden">
            <div class="modal-inner" role="dialog" aria-modal="true" aria-labelledby="modal-title">
                <h2 id="modal-for-manage-title">Cookie Preferences</h2>
                <button id="modal-for-manage-close" onclick="closeModal(this)">Close</button>

                <article id="cg-manage" class="cookie-glue-container" style="display: block">
                    <ol>
                        <li data-cookie-type="on-mandatory">
                            <input type="checkbox" name="necessary" id="cb-necessary" />
                            <h3><label for="cb-necessary">Necessary Cookies</label></h3>
                            <p>Description.</p>
                        </li>
                        <li data-cookie-type="on-optional">
                            <input type="checkbox" name="performance" id="cb-performance" />
                            <h3><label for="cb-performance">Performance Cookies</label></h3>
                            <p>Description.</p>
                        </li>
                        <li data-cookie-type="on-optional">
                            <input type="checkbox" name="functionality" id="cb-functionality" />
                            <h3><label for="cb-functionality">Functionality Cookies</label></h3>
                            <p>Description.</p>
                        </li>
                        <li data-cookie-type="off-optional">
                            <input type="checkbox" name="targeting" id="cb-targeting" />
                            <h3><label for="cb-targeting">Targeting Cookies</label></h3>
                            <p>Description.</p>
                        </li>
                    </ol>
                    <button class="cg-store" onclick="closeModal()">Save Preferences</button>
                </article>

            </div>
        </div>
    </div>

    <script>
        cg.push('necessary', function () {
            console.log('necessary allowed footer');
        }, function() {
            console.log('necessary denied footer');
        }, true);

        cg.push('functionality', function () {
            console.log('functionality allowed footer');
        }, function() {
            console.log('functionality denied footer');
        });

        cg.push('performance', function () {
            console.log('performance allowed footer');
        }, function() {
            console.log('performance denied footer');
        });

        cg.push('targeting', function () {
            console.log('targeting allowed footer');
        }, function() {
            console.log('targeting denied footer');
        });

        (function () {
            /**
             * Modal.
             *
             * Simplified implementation based on:
             * https://www.w3.org/TR/wai-aria-practices-1.1/#dialog_modal
             *
             * @constructor
             *
             * @param modalId
             *      The ID of the DOM node serving as the modal container.
             * @param focusOnOpen
             *      The ID of the DOM node to focus when the modal opens.
             * @param focusOnClose
             *      The ID of the DOM node to focus when the modal closes.
             * @param handleOnClose
             *      Callback for handling modal close.
             *
             * TODO:
             * 1. Refactor into ES6 class?
             * 2. Add error handling / types?
             */
            function Modal(modalId, focusOnOpen, focusOnClose, closeCallback) {
                this.closing = false;
                this.modalOverlay = document.getElementById(modalId);
                this.modalOnOpenFocus = document.getElementById(focusOnOpen);
                this.modalOnCloseFocus = document.getElementById(focusOnClose);
                this.body = document.getElementsByTagName('body')[0];
                this.pageContent = document.getElementById('outerWrapper');

                // DOM manipulation when modal is opened.
                this.modalOverlay.classList.add('modal-open');
                this.modalOverlay.firstElementChild.classList.remove('modal-hidden');
                this.body.classList.add('has-modal');
                this.pageContent.setAttribute('aria-hidden', 'true');
                this.modalOnOpenFocus.setAttribute('tabIndex', '-1');
                this.modalOnOpenFocus.focus();

                // Add event listener to trap focus in modal.
                this.modalOverlay.addEventListener('keydown', (e) => this.trapFocus(e));

                // Bind ESC key to close button.
                document.addEventListener('keyup', (e) => {
                    if (e.keyCode === 27) {
                        this.close();
                    }
                });

                // Close modal callback.
                this.closeCallback = closeCallback;
            }

            Modal.prototype.trapFocus = function (e) {
                this.focusable = this.modalOverlay.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                this.firstFocusable = this.focusable[0];
                this.lastFocusable = this.focusable[this.focusable.length - 1];

                // If on the last focusable element, set focus on first element with TAB.
                if (!e.shiftKey && e.keyCode === 9 && e.target === this.lastFocusable) {
                    e.preventDefault();
                    this.firstFocusable.focus();
                }
                // If on the first focusable element, set focus on last element with SHIFT+TAB.
                if (e.shiftKey && e.keyCode === 9 && e.target === this.firstFocusable) {
                    e.preventDefault();
                    this.lastFocusable.focus();
                }
            };

            Modal.prototype.close = function () {
                this.modalOverlay.classList.remove('modal-open');
                this.body.classList.remove('has-modal');
                this.pageContent.removeAttribute('aria-hidden');
                this.modalOverlay.firstElementChild.classList.add('modal-hidden');
                this.modalOverlay.removeEventListener('keydown', this.trapFocus);

                // Set focus to appropriate element.
                this.modalOnCloseFocus.focus();

                if (!this.closing) {
                    this.closing = true;
                    this.closeCallback();
                }
            };

            // Instantiate Modal.
            let modal;
            window.openModal = (modalId, focusOnOpen, focusOnClose, closeCallback) => {
                modal = new Modal(modalId, focusOnOpen, focusOnClose, closeCallback);
            };

            window.closeModal = () => {
                modal.close();
            };

        }());
    </script>

    <script async src="/dist/cookieglue.js"></script>
</body>

</html>