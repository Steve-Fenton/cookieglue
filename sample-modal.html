<!DOCTYPE html>
<html>

<head>
    <style>
        :focus {
            outline: 2px solid;
        }
        .modal {
            align-items: center;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            left: 0;
            pointer-events: none;
            position: fixed;
            right: 0;
            top: 0;
        }
        .modal-overlay {
            background-color: rgba(0,0,0,.5);
            bottom: 0;
            display: none;
            left: 0;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 1000;
        }
        .modal-inner {
            background: #fff;
            max-height: 80%;
            overflow-y: auto;
            padding: 20px;
            pointer-events: all;
            width: 80%;
        }
        .modal-open.modal-overlay {
            display: block;
        }
        .has-modal {
            overflow: hidden;
        }
    </style>

    <script>
        var cg = window.cg || { data: [], push: function (t, f, d) { if (d == null) d = false; cg.data.push({ type: t, script: f, def: d }); } };

        cg.push('necessary', function () {
            // Necessary Scripts Go Here
            console.log('Cookie Glue told me necessary is allowed in the header.');
        }, true);

        cg.push('functionality', function () {
            // Functionality Scripts Go Here
            console.log('Cookie Glue told me functionality is allowed in the header.');
        });

        cg.push('performance', function () {
            // Performance Scripts Go Here
            console.log('Cookie Glue told me performance is allowed in the header.');
        });

        cg.push('targeting', function () {
            // Targeting Scripts Go Here
            console.log('Cookie Glue told me targeting is allowed in the header.');
        });
    </script>
</head>

<body>
    <!-- Dummy class to target to make everything inside it "inert" when modal is open. -->
    <div class="page-content">
        <a href="#fallbackpage" class="cg-manage-opener">Manage Cookie
            Preferences</a>

        <h1>Example Website</h1>
        <a href="/index.html">Home</a> | <a href="/styled.html">Styled</a>

        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non nibh. Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis. Nullam at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in nunc erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.
        </p>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non nibh. Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis. Nullam at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in nunc erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.
        </p>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non nibh. Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis. Nullam at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in nunc erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.
        </p>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non nibh. Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis. Nullam at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in nunc erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.
        </p>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non nibh. Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis. Nullam at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in nunc erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.
        </p>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non nibh. Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis. Nullam at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in nunc erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.
        </p>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non nibh. Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis. Nullam at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in nunc erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.
        </p>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus at elit eu urna consectetur rhoncus in non nibh. Morbi pretium ac orci nec euismod. Donec vitae lorem dictum, malesuada risus sit amet, vulputate turpis. Nullam at enim eget turpis placerat interdum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in nunc erat. Duis sodales commodo tortor, et volutpat lorem maximus nec.
        </p>

        <article id="cg-notice" class="cookie-glue-container">
            <p>This website uses cookies and similar technologies to improve your online experience and to show tailored
                advertising to you.</p>
            <button class="cg-manage-opener">Manage</button> <button class="cg-accept">Accept</button>
            <p>You can view our <a href="#">privacy policy</a> for more information.</p>
        </article>
    </div>

    <!-- Ideally, modal needs to be sibling of ALL other page content (i.e. direct child of <body>). -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <div class="modal-inner" role="dialog" aria-modal="true" aria-labelledby="modal-title">
                <button id="js-modal-close">Close</button>

                <!-- TODO - inject modal content dynamically? -->
                <article id="cg-manage" class="cookie-glue-container" style="display: block">
                    <h2 id="modal-title">Cookie Preferences</h2>
                    <ol>
                        <li data-cookie-type="on-mandatory">
                            <!-- See https://codepen.io/basherkev/pen/KZQvoP for styling -->
                            <span class="toggle-button-wrapper">
                                <button name="necessary" id="cb-necessary" role="switch" aria-checked="true" aria-labelledby="cb-necessary">
                                    <span class="toggle-button-label">on</span>
                                    <span class="toggle-button-switch"></span>
                                </button>
                            </span>
                            <h3 id="cb-necessary">Necessary Cookies</h3>
                            <p>Description.</p>
                        </li>
                        <li data-cookie-type="on-optional">
                            <input type="checkbox" name="performance" id="cb-performance" />
                            <h3><label for="cb-performance">Performance Cookies</label></h3>
                            <p>Description.</p>
                        </li>
                        <li data-cookie-type="on-optional">
                            <input type="checkbox" name="functionality" id="cb-functionality" />
                            <h3><label for="cb-functionality">Functionality Cookies</label></h3>
                            <p>Description.</p>
                        </li>
                        <li data-cookie-type="off-optional">
                            <input type="checkbox" name="targeting" id="cb-targeting" />
                            <h3><label for="cb-targeting">Targeting and Advertising Cookies</label></h3>
                            <p>Description.</p>
                        </li>
                    </ol>

                    <button class="cg-store">Save Preferences</button>
                </article>

            </div>
        </div>
    </div>

    <script>
        cg.push('necessary', function () {
            // Necessary Scripts Go Here
            console.log('Cookie Glue told me necessary is allowed in the footer.');
        });

        cg.push('functionality', function () {
            // Functionality Scripts Go Here
            console.log('Cookie Glue told me functionality is allowed in the footer.');
        });

        cg.push('performance', function () {
            // Performance Scripts Go Here
            console.log('Cookie Glue told me performance is allowed in the footer.');
        });

        cg.push('targeting', function () {
            // Targeting Scripts Go Here
            console.log('Cookie Glue told me targeting is allowed in the footer.');
        });

        // Toggle button.
        const handleToggleButton = (e) => {
            const checked = e.currentTarget.getAttribute('aria-checked') === 'true';
            let label = e.currentTarget.getElementsByTagName('span')[0];
            e.currentTarget.setAttribute('aria-checked', !checked);
            label.textContent = !checked ? 'on' : 'off';
        };

        const toggleButton = document.querySelector('[role="switch"]');
        toggleButton.addEventListener('click', (e) => handleToggleButton(e), false);

        /**
         * Modal.
         *
         * TODO:
         * 1. Close modal if preferences are saved.
         * 3. 'triggerModalOpen' needs to be dynamic, and passed to modal instance.
         * 3. Ensure 'page-content' class is added to outermost wrapping DIV on the site, and ensure that 'modal-overlay' DIV is a direct child of BODY.
         */
        const modalOverlay = document.getElementById('modal-overlay');
        const modalInitialFocus = document.getElementById('modal-title');
        const body = document.getElementsByTagName('body')[0];
        const pageContent = document.getElementsByClassName('page-content')[0];
        const triggerModalClose = document.getElementById('js-modal-close');
        const triggerModalOpen = document.getElementsByClassName('cg-manage-opener')[0];
        let focusableElement;

        // DOM manipulation when modal is opened.
        modalOverlay.classList.add('modal-open');
        body.classList.add('has-modal');
        pageContent.setAttribute('aria-hidden', 'true');
        modalInitialFocus.setAttribute('tabIndex', '-1');
        modalInitialFocus.focus();

        // Trap keyboard focus inside modal.
        const focusable = modalOverlay.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        const firstFocusable = focusable[0];
        const lastFocusable = focusable[focusable.length - 1];

        modalOverlay.addEventListener('keydown', (e) => {
            // On the last focusable element, so set focus on first with TAB.
            if (!e.shiftKey && e.keyCode === 9 && e.target === lastFocusable) {
                console.log(firstFocusable)
                firstFocusable.focus();
            }
            // On the first focusable element, so set focus on last SHFT+TAB.
            if (e.shiftKey && e.keyCode === 9 && e.target === firstFocusable) {
                console.log(lastFocusable)
                lastFocusable.focus();
            }
        });

        // Close modal.
        const handleCloseModal = () => {
            modalOverlay.classList.remove('modal-open');
            body.classList.remove('has-modal');
            pageContent.removeAttribute('aria-hidden');

            // Set focus back to triggering element.
            triggerModalOpen.focus();
        };

        // Bind ESC key and modal close button.
        triggerModalClose.addEventListener('click', () => handleCloseModal(), false);
        document.addEventListener('keyup', (e) => {
            if (e.keyCode === 27) {
                handleCloseModal();
            }
        }, false);

    </script>

    <script async src="/dist/cookieglue.js"></script>
</body>

</html>
